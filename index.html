<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Georgia Power IRP – Energy & Water Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    :root {
      --bg: #050816;
      --panel: #0b1020;
      --panel-soft: #121932;
      --accent: #4fd1c5;
      --accent2: #63b3ed;
      --text: #f7fafc;
      --muted: #a0aec0;
      --border: #2d3748;
      --danger: #f56565;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1a365d 0, #050816 45%);
      color: var(--text);
      line-height: 1.4;
    }

    header {
      padding: 1.75rem clamp(1rem, 4vw, 3rem);
      border-bottom: 1px solid var(--border);
      background: linear-gradient(
        135deg,
        rgba(79, 209, 197, 0.18),
        rgba(99, 179, 237, 0.05)
      );
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    header h1 {
      margin: 0 0 0.25rem;
      font-size: clamp(1.8rem, 3vw, 2.6rem);
      letter-spacing: 0.03em;
    }

    header p {
      margin: 0.1rem 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .tagline {
      margin-top: 0.5rem;
      font-size: 0.95rem;
      color: #e2e8f0;
    }

    main {
      padding: 1.5rem clamp(1rem, 4vw, 3rem) 3rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    section {
      margin-bottom: 2.5rem;
    }

    h2 {
      margin: 0 0 0.75rem;
      font-size: 1.4rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--accent2);
    }

    h3 {
      margin: 1rem 0 0.5rem;
      font-size: 1.1rem;
      color: #e2e8f0;
    }

    p {
      margin: 0.25rem 0 0.6rem;
    }

    .muted {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .card {
      background: radial-gradient(circle at top left, #1a365d 0, #050816 60%);
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 1.25rem 1.4rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
    }

    .card-soft {
      background: #050816;
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      padding: 1rem 1.1rem;
    }

    .grid {
      display: grid;
      gap: 1.3rem;
    }

    @media (min-width: 900px) {
      .grid-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .img-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 0.8rem;
    }

    figure {
      margin: 0;
      border-radius: 0.9rem;
      overflow: hidden;
      background: #020617;
      border: 1px solid var(--border);
    }

    figure img {
      width: 100%;
      display: block;
      object-fit: cover;
      max-height: 180px;
    }

    figure figcaption {
      padding: 0.55rem 0.7rem 0.65rem;
      font-size: 0.85rem;
      color: var(--muted);
      border-top: 1px solid rgba(148, 163, 184, 0.2);
    }

    .scenario-pills {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.4rem;
    }

    .scenario-pill {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
    }

    .scenario-pill strong {
      color: #e2e8f0;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .scenario-tabs {
      display: inline-flex;
      border-radius: 999px;
      padding: 0.2rem;
      background: #020617;
      border: 1px solid var(--border);
    }

    .scenario-tab {
      border: none;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: var(--muted);
      transition: all 0.15s ease-out;
      white-space: nowrap;
    }

    .scenario-tab.active {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #0b1120;
      font-weight: 600;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    .year-control {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.85rem;
    }

    .year-badge {
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.16);
      border: 1px solid rgba(148, 163, 184, 0.45);
      font-weight: 600;
    }

    input[type="range"] {
      accent-color: var(--accent2);
    }

    .charts-grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 1040px) {
      .charts-grid {
        grid-template-columns: 2.1fr 1.4fr;
        align-items: stretch;
      }
    }

    .chart-panel {
      background: #020617;
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      padding: 0.7rem 0.75rem 0.8rem;
      min-height: 260px;
    }

    .chart-title {
      font-size: 0.82rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 0.1rem;
    }

    .chart-subtitle {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 0.35rem;
    }

    .chart {
      width: 100%;
      height: 260px;
    }

    .chart-tall {
      height: 320px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.35rem;
    }

    .badge {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 0.15rem 0.45rem;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .policy-grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 980px) {
      .policy-grid {
        grid-template-columns: 1.6fr 2fr;
      }
    }

    .annot {
      font-size: 0.83rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    .gis-placeholder {
      border: 1px dashed var(--border);
      border-radius: 0.9rem;
      padding: 0.85rem 1rem;
      font-size: 0.85rem;
      color: var(--muted);
      background: rgba(15, 23, 42, 0.7);
    }

    a {
      color: var(--accent2);
    }

    footer {
      padding: 1rem clamp(1rem, 4vw, 3rem) 2rem;
      border-top: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <header>
    <h1>Georgia Power IRP &amp; Water–Energy Dashboard</h1>
    <p>Capstone project for SUST 4500 &bull; University of Georgia</p>
    <p class="muted">
      <strong>Title:</strong> Got Water? Identifying Water Constraints amid Growing Energy Demand in Georgia<br />
      <strong>Authors:</strong> Chloe Glover, Natalie, Clarissa &mdash; in partnership with Cherry Street Energy
    </p>
    <p class="tagline">
      Explore how Georgia’s long-term resource choices reshape capacity, water use, and policy trade-offs across three IRP scenarios.
    </p>
  </header>

  <main>
    <!-- OVERVIEW IMAGES -->
    <section>
      <h2>Visual Overview</h2>
      <p class="muted">
        These reference graphics anchor the dashboard: core data inputs, capacity build-out, and associated water impacts.
      </p>
      <div class="img-grid">
        <figure>
          <img src="data.png" alt="Data and methods overview">
          <figcaption>Data inputs &amp; modeling workflow (Excel &amp; Monte Carlo engine).</figcaption>
        </figure>
        <figure>
          <img src="power.png" alt="Energy capacity visualization">
          <figcaption>Georgia Power summer capacity mix across IRP scenarios.</figcaption>
        </figure>
        <figure>
          <img src="water.png" alt="Water withdrawals and consumption visualization">
          <figcaption>Scenario-based water withdrawals by fuel type, 2025–2036.</figcaption>
        </figure>
      </div>
    </section>

    <!-- SCENARIO SUMMARY -->
    <section>
      <h2>Scenario Summary</h2>
      <div class="card grid grid-3">
        <div class="card-soft">
          <h3>Status Quo</h3>
          <p class="muted">
            Incremental build-out with moderate gas additions and steady nuclear output. Water use rises gradually as total capacity grows.
          </p>
          <div class="badge-row">
            <span class="badge">Baseline IRP</span>
            <span class="badge">Moderate water stress</span>
          </div>
        </div>
        <div class="card-soft">
          <h3>IRP Expansion</h3>
          <p class="muted">
            Higher overall capacity, led by gas and some coal retention. Reliability improves, but thermal cooling substantially increases withdrawals.
          </p>
          <div class="badge-row">
            <span class="badge">Highest capacity</span>
            <span class="badge">High water withdrawals</span>
          </div>
        </div>
        <div class="card-soft">
          <h3>Renewable Priority</h3>
          <p class="muted">
            Accelerated solar and clean energy build-out with relatively lower reliance on water-intensive fuels, shifting long-run water risk downward.
          </p>
          <div class="badge-row">
            <span class="badge">Solar-heavy mix</span>
            <span class="badge">Lower water intensity</span>
          </div>
        </div>
      </div>
      <div class="scenario-pills">
        <span class="scenario-pill"><strong>Fuel types:</strong> Nuclear, Natural Gas, Coal, Hydro, Solar, Other</span>
        <span class="scenario-pill"><strong>Horizon:</strong> 2025–2036 (summer capacity)</span>
      </div>
    </section>

    <!-- CAPACITY & WATER WITH SLIDER -->
    <section>
      <h2>Capacity &amp; Water by Scenario</h2>
      <div class="card">
        <div class="controls-row">
          <div>
            <div class="muted" style="font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.08em;">
              Scenario
            </div>
            <div class="scenario-tabs" id="scenario-tabs">
              <button class="scenario-tab active" data-scenario="Status Quo">Status Quo</button>
              <button class="scenario-tab" data-scenario="IRP Expansion">IRP Expansion</button>
              <button class="scenario-tab" data-scenario="Renewable Priority">Renewable Priority</button>
            </div>
          </div>

          <div class="year-control">
            <span class="muted" style="text-transform: uppercase; letter-spacing: 0.08em; font-size: 0.78rem;">
              Year
            </span>
            <span class="year-badge" id="year-label">2030</span>
            <input id="year-slider" type="range" min="2025" max="2036" step="1" value="2030" />
          </div>
        </div>

        <div class="charts-grid" style="margin-top: 0.5rem;">
          <div class="chart-panel">
            <div class="chart-title">Capacity Mix by Fuel (MW equivalent)</div>
            <div class="chart-subtitle">
              Stacked bars show relative contribution of each fuel within the selected scenario and year.
            </div>
            <div id="capacity-bar" class="chart chart-tall"></div>
          </div>

          <div class="chart-panel">
            <div class="chart-title">Capacity Mix Donut – Percent Share</div>
            <div class="chart-subtitle">
              Donut shows the share of total capacity by fuel for the same scenario &amp; year.
            </div>
            <div id="capacity-donut" class="chart"></div>
          </div>
        </div>

        <div class="chart-panel" style="margin-top: 0.9rem;">
          <div class="chart-title">Water Use by Fuel (relative units)</div>
          <div class="chart-subtitle">
            Stacked bars approximate total water withdrawals/consumption by fuel for the selected scenario &amp; year.
          </div>
          <div id="water-bar" class="chart chart-tall"></div>
        </div>
      </div>
    </section>

    <!-- MONTE CARLO OUTLOOK -->
    <section>
      <h2>Monte Carlo Outlook</h2>
      <div class="card grid grid-2">
        <div class="card-soft">
          <h3>Scenario Distribution by 2036</h3>
          <p class="muted">
            To capture uncertainty in build-out and cooling requirements, we simulate hundreds of possible 2036 outcomes for each scenario.
            Each run perturbs total capacity around the IRP anchors and samples across the three scenarios.
          </p>
          <p class="muted">
            The resulting distribution highlights how an expansive, gas-heavy path (IRP Expansion) tends to push total capacity higher but also expands
            the upper tail of water demand, while Renewable Priority compresses the water-intensive tail without sacrificing long-run capacity as sharply.
          </p>
          <p class="muted">
            These results reinforce the value of proactive planning: front-loaded renewables and cooling retrofits dampen worst-case outcomes as AI-driven
            load growth accelerates.
          </p>
        </div>
        <div class="chart-panel">
          <div class="chart-title">Monte Carlo – Total 2036 Capacity</div>
          <div class="chart-subtitle">
            Simulated distributions of total summer capacity (relative units) by scenario.
          </div>
          <div id="monte-carlo" class="chart chart-tall"></div>
        </div>
      </div>
    </section>

    <!-- POLICY SECTION -->
    <section>
      <h2>Policy &amp; Governance Implications</h2>
      <div class="card policy-grid">
        <div class="card-soft">
          <h3>6.3 Policy–Impact Matrix</h3>
          <p class="muted">
            To evaluate relative outcomes, each policy action was scored from 1 (low) to 5 (high) across four criteria:
            energy reliability, water stress reduction, economic cost, and implementation feasibility. The heat map to the
            right visualizes these trade-offs.
          </p>
          <p class="muted" style="margin-top: 0.5rem;">
            <strong>Figure 5. Policy–Impact Matrix Overview.</strong> Renewable expansion and closed-loop cooling cluster in
            the high-reliability, high water-benefit quadrant, while demand-side management achieves meaningful reductions
            at comparatively low cost.
          </p>
          <h3 style="margin-top: 1.1rem;">6.4 Interpretation</h3>
          <p class="muted">
            Sensitivity results demonstrate that renewable expansion and closed-loop cooling deliver the most significant
            co-benefits across both energy reliability and water conservation. In contrast, aggressive gas expansion
            increases reliability but also amplifies water stress, especially under hotter, drier conditions.
          </p>
          <p class="muted">
            Demand-side management remains the most cost-effective strategy with broad feasibility, particularly when paired
            with granular time-of-use rates and flexible load programs for data centers and large commercial users. These
            findings affirm the need for adaptive, multi-sector governance as Georgia experiences rapid AI-driven industrial
            growth. Embedding water budgeting standards and renewable incentives into utility regulation can enhance
            long-term sustainability while preserving grid reliability.
          </p>
          <p class="annot">
            Note: For the “Economic cost” axis in the heat map, a higher score indicates higher cost (less favorable).
          </p>
        </div>

        <div class="chart-panel">
          <div class="chart-title">Policy–Impact Heat Map</div>
          <div class="chart-subtitle">
            Scores (1–5) across energy reliability, water stress reduction, economic cost, and implementation feasibility.
          </div>
          <div id="policy-heatmap" class="chart chart-tall"></div>
        </div>
      </div>
    </section>

    <!-- GIS SECTION PLACEHOLDER -->
    <section>
      <h2>GIS – Spatial View of Plant &amp; Watershed Risk</h2>
      <div class="card">
        <p class="muted">
          This section is reserved for your ArcGIS Online map (plant locations, watersheds, and thermal load overlays).
          Paste your existing ArcGIS embed code inside the placeholder below so it appears in the same layout.
        </p>
        <div class="gis-placeholder">
          <!-- Replace this comment with your actual ArcGIS iframe or script embed -->
          <!-- Example:
          <iframe src="YOUR_ARCGIS_EMBED_URL"
                  width="100%" height="420" frameborder="0" allowfullscreen>
          </iframe>
          -->
          <strong>GIS Placeholder:</strong> insert ArcGIS iframe here to visualize plant locations, river basins, and
          county-level water risk under each IRP scenario.
        </div>
      </div>
    </section>
  </main>

  <footer>
    Georgia Power IRP &amp; Water–Energy Nexus &bull; SUST 4500 &mdash; Dashboard prototype for academic use only.
  </footer>

  <script>
    // ---------------------------
    //  DATA: ANCHOR YEARS (2025, 2030, 2036)
    //  We interpolate between these to fill the slider for 2025–2036.
    // ---------------------------
    const fuels = ["Nuclear", "Natural Gas", "Coal", "Hydro", "Solar", "Other"];
    const anchorYears = [2025, 2030, 2036];

    const anchorCapacity = {
      "Status Quo": {
        2025: { Nuclear: 2563.94472, "Natural Gas": 9401.13064, Coal: 3418.59296, Hydro: 1068.3103, Solar: 2991.26884, Other: 1922.95854 },
        2030: { Nuclear: 3364.34472, "Natural Gas": 12335.93064, Coal: 4485.79296, Hydro: 1401.8103, Solar: 3925.06884, Other: 2523.25854 },
        2036: { Nuclear: 3930.98472, "Natural Gas": 14413.61064, Coal: 5241.31296, Hydro: 1637.9103, Solar: 4586.14884, Other: 2948.23854 }
      },
      "IRP Expansion": {
        2025: { Nuclear: 2563.94472, "Natural Gas": 9401.13064, Coal: 3418.59296, Hydro: 1068.3101, Solar: 2991.26884, Other: 1922.95854 },
        2030: { Nuclear: 5046.51708, "Natural Gas": 13177.01682, Coal: 2803.6206, Hydro: 1962.53442, Solar: 4485.79296, Other: 560.72412 },
        2036: { Nuclear: 5896.47708, "Natural Gas": 15396.35682, Coal: 3275.8206, Hydro: 2293.07442, Solar: 5241.31296, Other: 655.16412 }
      },
      "Renewable Priority": {
        2025: { Nuclear: 2563.94472, "Natural Gas": 9401.13064, Coal: 3418.59296, Hydro: 1068.3101, Solar: 2991.26884, Other: 1922.95854 },
        2030: { Nuclear: 7009.0515, "Natural Gas": 9812.6721, Coal: 560.72412, Hydro: 3364.34472, Solar: 6448.32738, Other: 841.08618 },
        2036: { Nuclear: 8189.5515, "Natural Gas": 11465.3721, Coal: 655.16412, Hydro: 3930.98472, Solar: 7534.38738, Other: 982.74618 }
      }
    };

    const anchorWater = {
      "Status Quo": {
        2025: { Nuclear: 14172.538, "Natural Gas": 6391.98064, Coal: 1131.55427, Hydro: 38.6033927, Solar: 149.360036, Other: 120.004612 },
        2030: { Nuclear: 18596.8531, "Natural Gas": 8387.39859, Coal: 1484.79747, Hydro: 50.6544152, Solar: 195.986537, Other: 157.467078 },
        2036: { Nuclear: 21729.0294, "Natural Gas": 9800.0468, Coal: 1734.87459, Hydro: 59.1858887, Solar: 228.995584, Other: 183.988482 }
      },
      "IRP Expansion": {
        2025: { Nuclear: 14172.538, "Natural Gas": 6391.98064, Coal: 6809.82938, Hydro: 38.6033855, Solar: 149.360036, Other: 120.004612 },
        2030: { Nuclear: 27895.2796, "Natural Gas": 8959.26668, Coal: 5584.80584, Hydro: 70.9161813, Solar: 223.984614, Other: 34.992684 },
        2036: { Nuclear: 32593.5441, "Natural Gas": 10468.2318, Coal: 6525.42717, Hydro: 82.8602442, Solar: 261.709239, Other: 40.8863293 }
      },
      "Renewable Priority": {
        2025: { Nuclear: 14172.538, "Natural Gas": 6391.98064, Coal: 6809.82938, Hydro: 38.6033855, Solar: 149.360036, Other: 120.004612 },
        2030: { Nuclear: 38743.4439, "Natural Gas": 6671.79433, Coal: 1116.96117, Hydro: 121.570597, Solar: 321.977883, Other: 52.489026 },
        2036: { Nuclear: 45268.8112, "Natural Gas": 7795.49177, Coal: 1305.08543, Hydro: 142.046133, Solar: 376.207031, Other: 61.329494 }
      }
    };

    function interpolateValue(v1, v2, t) {
      return v1 + (v2 - v1) * t;
    }

    function getInterpolatedRow(anchorObj, scenario, year) {
      const sData = anchorObj[scenario];
      if (!sData) return null;

      if (year <= anchorYears[0]) return sData[anchorYears[0]];
      if (year >= anchorYears[anchorYears.length - 1]) return sData[anchorYears[anchorYears.length - 1]];

      let y1 = anchorYears[0], y2 = anchorYears[1];
      if (year > 2030) {
        y1 = 2030;
        y2 = 2036;
      }
      const t = (year - y1) / (y2 - y1);
      const out = {};
      fuels.forEach(f => {
        out[f] = interpolateValue(sData[y1][f], sData[y2][f], t);
      });
      return out;
    }

    // ---------------------------
    //  CHART UPDATE FUNCTIONS
    // ---------------------------
    function updateCharts() {
      const scenario = document.querySelector(".scenario-tab.active").dataset.scenario;
      const year = parseInt(document.getElementById("year-slider").value, 10);
      document.getElementById("year-label").textContent = year;

      const capRow = getInterpolatedRow(anchorCapacity, scenario, year);
      const waterRow = getInterpolatedRow(anchorWater, scenario, year);

      const capValues = fuels.map(f => capRow[f]);
      const totalCap = capValues.reduce((a, b) => a + b, 0);

      // Capacity stacked bar (x = fuel)
      const capBarTraces = fuels.map(f => ({
        x: [f],
        y: [capRow[f]],
        name: f,
        type: "bar"
      }));

      Plotly.newPlot("capacity-bar", capBarTraces, {
        barmode: "stack",
        margin: { l: 50, r: 10, t: 30, b: 40 },
        paper_bgcolor: "#020617",
        plot_bgcolor: "#020617",
        xaxis: {
          tickfont: { color: "#cbd5f5" },
          title: { text: "Fuel type", font: { color: "#cbd5f5" } }
        },
        yaxis: {
          title: { text: "Capacity (MW equivalent)", font: { color: "#cbd5f5" } },
          tickfont: { color: "#cbd5f5" }
        },
        legend: {
          title: { text: "Fuel type", font: { color: "#cbd5f5" } },
          font: { color: "#e2e8f0", size: 10 }
        }
      }, { responsive: true });

      // Capacity donut
      Plotly.newPlot("capacity-donut", [{
        labels: fuels,
        values: capValues,
        type: "pie",
        hole: 0.55,
        textinfo: "label+percent",
        hovertemplate: "%{label}<br>%{value:.0f} MW eq.<extra></extra>"
      }], {
        margin: { l: 10, r: 10, t: 10, b: 10 },
        paper_bgcolor: "#020617"
      }, { responsive: true });

      // Water stacked bar
      const waterBarTraces = fuels.map(f => ({
        x: [f],
        y: [waterRow[f]],
        name: f,
        type: "bar"
      }));

      Plotly.newPlot("water-bar", waterBarTraces, {
        barmode: "stack",
        margin: { l: 60, r: 10, t: 30, b: 40 },
        paper_bgcolor: "#020617",
        plot_bgcolor: "#020617",
        xaxis: {
          tickfont: { color: "#cbd5f5" },
          title: { text: "Fuel type", font: { color: "#cbd5f5" } }
        },
        yaxis: {
          title: { text: "Relative water use (index)", font: { color: "#cbd5f5" } },
          tickfont: { color: "#cbd5f5" }
        },
        legend: {
          title: { text: "Fuel type", font: { color: "#cbd5f5" } },
          font: { color: "#e2e8f0", size: 10 }
        }
      }, { responsive: true });
    }

    // ---------------------------
    //  MONTE CARLO
    // ---------------------------
    function generateMonteCarlo() {
      const scenarios = Object.keys(anchorCapacity);
      const traces = [];

      scenarios.forEach((s, i) => {
        const row2036 = anchorCapacity[s][2036];
        const mean = fuels.reduce((a, f) => a + row2036[f], 0);
        const sigma = 0.08 * mean; // 8% standard deviation

        const samples = [];
        const n = 400;
        for (let k = 0; k < n; k++) {
          // quick approximate random variation
          const jitter = (Math.random() - 0.5) * 2; // -1 to 1
          samples.push(mean + sigma * jitter * 0.9);
        }

        traces.push({
          x: samples,
          type: "histogram",
          opacity: 0.6,
          name: s,
          nbinsx: 30
        });
      });

      Plotly.newPlot("monte-carlo", traces, {
        barmode: "overlay",
        margin: { l: 60, r: 10, t: 30, b: 40 },
        paper_bgcolor: "#020617",
        plot_bgcolor: "#020617",
        xaxis: {
          title: { text: "Total 2036 summer capacity (relative units)", font: { color: "#cbd5f5" } },
          tickfont: { color: "#cbd5f5" }
        },
        yaxis: {
          title: { text: "Simulated frequency", font: { color: "#cbd5f5" } },
          tickfont: { color: "#cbd5f5" }
        },
        legend: {
          title: { text: "Scenario", font: { color: "#cbd5f5" } },
          font: { color: "#e2e8f0", size: 10 }
        }
      }, { responsive: true });
    }

    // ---------------------------
    //  POLICY HEAT MAP
    // ---------------------------
    function drawPolicyHeatmap() {
      const policies = [
        "Renewable expansion",
        "Closed-loop cooling retrofits",
        "Aggressive gas expansion",
        "Demand-side management"
      ];
      const criteria = [
        "Energy reliability",
        "Water stress reduction",
        "Economic cost (5 = higher)",
        "Implementation feasibility"
      ];

      // Scores are qualitative and chosen to match your written narrative.
      const z = [
        [5, 5, 3, 4], // Renewable expansion
        [4, 5, 4, 3], // Closed-loop cooling
        [5, 1, 4, 3], // Aggressive gas expansion
        [3, 3, 2, 5]  // Demand-side management
      ];

      const data = [{
        z,
        x: criteria,
        y: policies,
        type: "heatmap",
        colorscale: "YlGnBu",
        reversescale: false,
        colorbar: {
          title: "Score (1–5)",
          tickfont: { color: "#cbd5f5" },
          titlefont: { color: "#cbd5f5" }
        }
      }];

      Plotly.newPlot("policy-heatmap", data, {
        margin: { l: 150, r: 10, t: 20, b: 60 },
        paper_bgcolor: "#020617",
        plot_bgcolor: "#020617",
        xaxis: {
          tickfont: { color: "#cbd5f5" }
        },
        yaxis: {
          tickfont: { color: "#cbd5f5" }
        }
      }, { responsive: true });
    }

    // ---------------------------
    //  EVENT LISTENERS & INIT
    // ---------------------------
    document.getElementById("year-slider").addEventListener("input", updateCharts);

    document.querySelectorAll(".scenario-tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".scenario-tab").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        updateCharts();
      });
    });

    // Initial render
    updateCharts();
    generateMonteCarlo();
    drawPolicyHeatmap();
  </script>
</body>
</html>
